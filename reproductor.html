<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor - Ripper</title>
    <link rel="stylesheet" href="css/estilos.css">
    <style>
        /* Estilos básicos para asegurar que el video se vea bien */
        #contenedor-video {
            width: 100%;
            aspect-ratio: 16 / 9;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .info-tema {
            padding: 15px;
            color: white;
            background: #1a1a1a;
            border-radius: 8px;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <button onclick="window.history.back()" style="background:none; border:none; color:red; cursor:pointer;">← Volver</button>
            <h1 id="titulo-tema">Cargando...</h1>
        </header>

        <div id="contenedor-video">
            <p style="color:white;">Cargando reproductor...</p>
        </div>

        <div class="info-tema">
            <h3 id="artista-tema"></h3>
            <p>Tonalidad: <span id="tono-tema"></span></p>
        </div>
    </div>

    <script type="module">
        import { baseDeTemas } from './js/temas.js';

        // 1. Obtener el ID del tema desde la URL (ej: reproductor.html?id=1)
        const params = new URLSearchParams(window.location.search);
        const idTema = params.get('id');
        const tema = baseDeTemas[idTema];

        const contenedor = document.getElementById('contenedor-video');

        if (tema) {
            // Llenar info de texto
            document.getElementById('titulo-tema').textContent = tema.titulo;
            document.getElementById('artista-tema').textContent = tema.artista || "Artista desconocido";
            document.getElementById('tono-tema').textContent = tema.tonalidad;

            // 2. LÓGICA DEL REPRODUCTOR UNIVERSAL
            if (tema.videoId === null) {
                // Caso: No hay video disponible todavía
                contenedor.innerHTML = `<div style="text-align:center; color:#888;">
                    <p>⚠️ Video no disponible para este tema.</p>
                </div>`;
            } 
            else if (tema.fuente === "drive") {
                // Caso: GOOGLE DRIVE
                contenedor.innerHTML = `
                    <iframe 
                        src="https://drive.google.com/file/d/${tema.videoId}/preview" 
                        allow="autoplay">
                    </iframe>`;
            } 
            else {
                // Caso: YOUTUBE (Por defecto)
                // Usamos el ID y el tiempo de inicio (tema.inicio)
                contenedor.innerHTML = `
                    <iframe 
                        src="https://www.youtube.com/embed/${tema.videoId}?start=${tema.inicio}" 
                        allowfullscreen>
                    </iframe>`;
            }
        } else {
            contenedor.innerHTML = `<p style="color:red;">Error: Tema no encontrado.</p>`;
        }
    </script>
</body>
</html>